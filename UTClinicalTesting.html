<!DOCTYPE html>
<head>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <link href="animatedline_styles.css" type="text/css" rel="stylesheet" />
</head>
<body>
    <header id="title">
        <h1>UT <span class="highlight">Student</span> Clinical Testing Positivity Rate</h1>
        <!-- <h2>From Oct. 11 to Oct. 16, <b class="highlight">3.7%</b> students tested positive at University Health Services and UT Health Austin.</h2> -->
        <h2>University Health Services and UT Health Austin reported a <b class="highlight">3.7%</b> student positivity rate from Oct. 11 to Oct. 16.</h2>
    </header>
    <script id="chart">
        // data
        const data = [{ date: "8/26/2020", value: 0.00 },
        { date: "8/27/2020", value: 1.96 },
        { date: "8/28/2020", value: 5.15 },
        { date: "8/29/2020", value: 5.15 },
        { date: "8/30/2020", value: 5.15 },
        { date: "8/31/2020", value: 6.66 },
        { date: "9/1/2020", value: 9.40 },
        { date: "9/2/2020", value: 13.54 },
        { date: "9/3/2020", value: 15.51 },
        { date: "9/4/2020", value: 18.07 },
        { date: "9/5/2020", value: 20.02 },
        { date: "9/6/2020", value: 20.02 },
        { date: "9/7/2020", value: 20.02 },
        { date: "9/8/2020", value: 20.84 },
        { date: "9/9/2020", value: 21.41 },
        { date: "9/10/2020", value: 16.42 },
        { date: "9/11/2020", value: 14.41 },
        { date: "9/12/2020", value: 13.79 },
        { date: "9/13/2020", value: 13.79 },
        { date: "9/14/2020", value: 14.25 },
        { date: "9/15/2020", value: 13.72 },
        { date: "9/16/2020", value: 13.61 },
        { date: "9/17/2020", value: 11.71 },
        { date: "9/18/2020", value: 11.71 },
        { date: "9/19/2020", value: 11.11 },
        { date: "9/20/2020", value: 10.48 },
        { date: "9/21/2020", value: 10.26 },
        { date: "9/22/2020", value: 8.13 },
        { date: "9/23/2020", value: 8.2 },
        { date: "9/24/2020", value: 7.11 },
        { date: "9/25/2020", value: 6.67 },
        { date: "9/26/2020", value: 6.98 },
        { date: "9/27/2020", value: 6.98 },
        { date: "9/28/2020", value: 6.58 },
        { date: "9/29/2020", value: 5.64 },
        { date: "9/30/2020", value: 5.49 },
        { date: "10/1/2020", value: 4.51 },
        { date: "10/2/2020", value: 4.12 },
        { date: "10/3/2020", value: 4.00 },
        { date: "10/4/2020", value: 4.00 },
        { date: "10/5/2020", value: 3.87 },
        { date: "10/6/2020", value: 3.99 },
        { date: "10/7/2020", value: 3.70 },
        { date: "10/8/2020", value: 4.05 },
        { date: "10/9/2020", value: 3.80 },
        { date: "10/10/2020", value: 3.80 },
        { date: "10/11/2020", value: 3.80 },
        { date: "10/12/2020", value: 4.16 },
        { date: "10/13/2020", value: 3.83 },
        { date: "10/14/2020", value: 4.25 },
        { date: "10/15/2020", value: 4.09 },
        { date: "10/16/2020", value: 4.00 }];

        // create SVG and padding for the chart
        const svg = d3.select("body")
            .append("svg")
            .attr("height", 300)
            .attr("width", 600);
        const margin = { top: 0, bottom: 20, left: 30, right: 20 };
        const chart = svg.append("g").attr("transform", `translate(${margin.left},0)`);
        const width = +svg.attr("width") - margin.left - margin.right;
        const height = +svg.attr("height") - margin.top - margin.bottom;
        const grp = chart
        .append("g")
        .attr("transform", `translate(-${margin.left},-${margin.top})`);

        // convert dates from data 
        var parseTime = d3.timeParse("%m/%d/%Y");

        data.forEach(function (d) {
            d.date = parseTime(d.date);
        });

        // create scales
        const xScale = d3
            .scaleTime()
            .range([0, width])
            .domain(d3.extent(data, function (d) { return d.date; }))
            ;

        const yScale = d3
            .scaleLinear()
            .range([height, 0])
            .domain(d3.extent(data, function (d) { return d.value; }))
            ;

        // generate a line using D3 line()
        const line = d3.line()
            .x(d => xScale(d.date))
            .y(d => yScale(d.value))
            ;

        // add the line to chart and style
        const path = grp
            .append("path")
            .attr("transform", `translate(${margin.left},0)`)
            .data([data])
            .attr("fill", "none")
            .attr("stroke", "#f5842e")
            .attr("stroke-linejoin", "round")
            .attr("stroke-linecap", "round")
            .attr("stroke-width", 2)
            .attr("d", line);

        // get total length of SVG path
        const pathLength = path.node().getTotalLength();

        // add a basic D3 transition
        const transitionPath = d3
            .transition()
            .ease(d3.easeSin)
            .duration(5000);

        path
            .attr("stroke-dashoffset", pathLength)
            .attr("stroke-dasharray", pathLength)
            .transition(transitionPath)
            .attr("stroke-dashoffset", 0);
    
        // add the X Axis
        chart
            .append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b %d")));
        
        // add the Y Axis
        chart
            .append("g")
            .attr("transform", `translate(0, 0)`)
            .call(d3.axisLeft(yScale).tickFormat(d => d + "%"));
    </script>
    <h3>Source: UT Austin COVID-19 Dashboard</h3>
</body>

